# 悪夢のパジャマ (Nightmare Pajama)

Pygameで作成されたかまいたちの夜風のサウンドノベルゲーム

## プロジェクト概要

「悪夢のパジャマ」は、着ると必ず悪夢を見るという黒いパジャマを着た主人公が、悪夢の世界で様々な恐怖と向き合いながら成長していくホラーサウンドノベルです。

### 主な特徴
- **5000字以上のストーリー**: 約5分以上のプレイ時間
- **6つのマルチエンディング**: すべての選択肢が独自のエンディングに到達
- **ユーザーの夢の要素**: 大量の虫、蜂、大きな駅、巨大アスレチック、自分の家、知らない建物、落下感覚、駐車場など
- **明朝体フォント**: Noto Serif CJKを使用したホラー風の文字表現
- **タイプライター効果**: ゆっくりとしたテキスト表示で緊張感を演出

## 技術仕様

### 開発環境
- **言語**: Python 3.x
- **ライブラリ**: Pygame 2.6.1+
- **依存関係管理**: Poetry
- **開発ツール**: VS Code

### プロジェクト構造
```
nightmare_pajama/
├── src/
│   ├── main.py              # エントリーポイント
│   ├── game_engine.py       # ゲームメインループ
│   ├── text_display.py      # テキスト表示システム
│   ├── choice_system.py     # 選択肢システム
│   ├── scenario.py          # シナリオデータ
│   ├── sound_manager.py     # サウンド管理
│   └── save_system.py       # セーブ・ロード機能
├── assets/
│   ├── images/              # 背景画像
│   ├── sounds/              # 効果音
│   ├── music/               # BGM
│   └── fonts/               # フォントファイル
├── data/                    # セーブデータ
├── .vscode/                 # VS Code設定
├── pyproject.toml           # Poetry設定
├── poetry.lock              # 依存関係ロック
└── CLAUDE.md               # この文書
```

## インストール・実行方法

### 1. 依存関係のインストール
```bash
poetry install
```

### 2. ゲーム実行
```bash
poetry run python src/main.py
```

### 3. VS Codeでの実行
- **F5キー**: ゲーム実行
- デバッグモードでの実行も可能

## ゲーム操作

### 基本操作
- **スペースキー**: テキスト送り（タイプライター中は全文表示、完了後は次のシーンへ）
- **上下キー**: 選択肢の選択
- **Enter/スペースキー**: 選択決定
- **Escキー**: ゲーム終了

### ゲームフロー
1. **オープニング**: 黒いパジャマを着て目覚める
2. **分岐**: 3つの初期選択肢から物語が分岐
3. **探索**: 悪夢の世界で様々な場面に遭遇
4. **エンディング**: 6つの異なる結末

## ストーリー構成

### メインテーマ
- **恐怖との向き合い方**: 逃避か受容か
- **内面の成長**: 子供の心と大人の知恵の統合
- **自己受容**: 負の感情も含めた自分の受け入れ

### 6つのエンディング
1. **逃避の朝**: 恐怖から逃げて一時的な安らぎを得る
2. **変容の銀**: 自分を受け入れ、パジャマが銀色に変化
3. **調和の闇**: 悪夢も含めて自分として受け入れる
4. **癒しの光**: 内なる子供と和解し、心の傷を癒す
5. **知恵の虹**: 成長の意味を理解し、虹色のパジャマを得る
6. **統合の白**: 内なる子供と大人が完全に統一される

## システム仕様

### TextDisplay クラス
- **フォント**: Noto Serif CJK Regular (明朝体)
- **サイズ**: 26px
- **表示位置**: 画面中央
- **効果**: タイプライター効果（1文字/フレーム）
- **枠**: なし（背景透明）

### ChoiceSystem クラス
- **フォント**: Noto Serif CJK Regular
- **サイズ**: 28px
- **選択表示**: 色変更 + ▶マーク
- **枠**: なし
- **選択色**: 白→赤みがかった色

### GameEngine クラス
- **解像度**: 1024x768
- **フレームレート**: 60fps
- **背景色**: 深い青系 (10, 10, 20)
- **状態管理**: "text" / "choice"

### Scenario クラス
- **総文字数**: 約7000字
- **シーン数**: 30+
- **分岐数**: 15以上
- **エンディング**: 6種類

## 開発者向け情報

### 新しいシーンの追加
```python
"scene_name": {
    "text": "表示するテキスト\\n改行は\\nを使用",
    "background": "背景ID",
    "choices": [
        {"text": "選択肢1", "next": "次のシーン"},
        {"text": "選択肢2", "next": "別のシーン"}
    ]
}
```

### エンディングの追加
```python
"ending_name": {
    "text": "エンディングテキスト\\n\\n【エンディング: タイトル】",
    "background": "背景ID",
    "choices": []  # 空の配列でエンディングを示す
}
```

### サウンド追加
```python
# sound_manager.py
self.sound_manager.load_bgm("assets/music/bgm.ogg")
self.sound_manager.load_sound_effect("click", "assets/sounds/click.wav")
```

## デバッグ・テスト

### 一般的な問題
- **フォントが表示されない**: Noto CJKフォントのインストール確認
- **Pygameインポートエラー**: Poetry環境の確認
- **文字化け**: フォントパスの確認

### ログ出力
- コンソールにエラーメッセージが表示される
- フォント読み込み失敗時は代替フォントを使用

## 今後の拡張予定

### 機能追加
- [ ] BGM・効果音の実装
- [ ] 背景画像の追加
- [ ] セーブ・ロード機能の実装
- [ ] 設定画面の追加
- [ ] フルスクリーン対応

### ストーリー拡張
- [ ] サブストーリーの追加
- [ ] 隠しエンディングの実装
- [ ] キャラクター立ち絵の追加

## ライセンス

個人プロジェクト

## 作成者

Claude Code & Human