# Nostalgic Counter プロジェクト概要

## 背景
昔、インターネットにはカウンタという文化があった。
ホームページを訪れた人をカウントして、訪れた人に対して表示する仕組みである。
それを最新の技術で実現して、自分のサイトに埋め込むほか、APIを公開して使ってもらいたい。
名前をNostalgic Counterとする。

## 機能要件

### カウンタ機能
- 累計の人数だけでなく、今日、昨日、直近一週間、直近一ヶ月での表示も可能
- 累計のリセットや、10000からスタートなども可能

### 認証・セキュリティ
- ユーザー登録やログイン、認証の仕組みは必要ない。個人情報保護法に配慮する必要のないシンプルな仕組みにする
- 累計の記録をただURLごとにしてしまっては、他人のサイトのURLを登録できてしまうし、0へのリセットを誰でも行えてしまう
- 0へのリセットなどは私だけの操作にして、ユーザーIDなしでただURLごとに累計を管理すべきかもしれない
- 私だけができる操作の仕方が必要
- 管理画面を作りたくないので、管理者用の秘密のAPIとか？

### 技術スタック
- ほかのサービスをすでにVercelで作っているため、このプロダクトもNextで作るならば、永続化はVercelの仕組みを使う
- すべて無料で可能な設計が条件
- 細かく検索する必要がないため、RDBよりKeyValue型のDBが良い？

### データ管理
- 累計はサイトごとにもつ必要がある。ドメイン単位なのかその中の1ページだけの累計なのかは、設置するユーザーのニーズによる

### 実装方式
- ユーザーがサイトを訪れた、ということを認識する仕組みが必要
- ユーザーに長いスクリプトを設置してもらうのはハードルが高い。しかし、なにかしら自身のサイトであるという証明ができないと、他人のサイトの累計を調べることができてしまう
- カウンタのAPIは24時間稼働するが、そこから各URLのサイトの訪問人数を調べに行く仕組みは存在しないと思う
- なので、各URLからAPIを呼んでもらうという仕組みに限られるはず
- scriptタグで、このサービスのAPI（いま訪問したという報告用）を呼ぶように、短いスクリプトを設置してもらうことは避けられないのでは
- 連続訪問など多重カウントを防ぐ

### 表示機能
- カウンタ画像の表示方法だが、テキスト、画像で表示できる
- 累計、今日で2回呼ぶと負荷がかかるため、1回でそのURLとしてのすべての情報は取得し、どれを表示するかはユーザーに任せる
- 画像をユーザーに用意してもらう方法は自由度が高まるが、ユーザー側でAPIをfetchし、JavaScriptで動的に画像を表示してもらう必要があり、そのfetch用関数などをパッケージにしないと勧めにくい
- 将来的にNPMとして公開するのも良いが、まずは自分のサイトでAPIとしてホストし、ユーザーにはそこにアクセスしてもらうだけの仕組みのほうがシンプルで良い
- そう考えると、画像ごとAPIで返すのがシンプルと言える。小さいサイズのwebpで数種類を用意すれば転送量も少なくなるだろう